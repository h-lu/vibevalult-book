# 第十二章：对抗“越界”：授权，划定你的边界

> "你的，才是你的。不是你的，你不能碰。"

*   **本章危机**: 系统虽然认识我们了，但它没有“边界感”。任何登录的用户都可以操作不属于他的资源。我的私人播放列表正在被陌生人修改！**我们面临“所有权危机”**。
*   **本章顿悟**: 我们需要在系统中建立“所有权”的概念，并实施访问控制，来回答第二个根本问题：“你能做什么？” 这就是**授权 (Authorization)**。

---
## 本章结构

*   **`12.1-the-foundation-crisis.md`: 地基危机：业务主键的陷阱**
    *   **核心思想**: 在我们尝试将`User`与`Playlist`关联时，会立刻发现`Playlist`使用`String name`作为主键的致命缺陷。这是一个完美的、由真实需求驱动的重构教学案例。
    *   **顿悟**: 必须将记录的“身份”与“属性”分离，引入与业务无关的**技术主键**。

*   **`12.2-refactoring-for-identity.md`: 重构！为身份加固地基**
    *   **核心思想**: 带领读者完成一次关键的模型重构：将`Playlist`的主键从`String`改为自增的`Long id`。
    *   **Vibe Check**:
        1.  **核心练习**: 严格按照步骤，修改实体、Repository、Service和Controller。
        2.  **回归测试**: **[关键]** 重新运行之前的所有集成测试，证明重构在改善内部结构的同时，没有破坏任何外部功能。

*   **`12.3-forging-the-chain-of-ownership.md`: 建立所有权关联**
    *   **核心思想**: 在坚实的地基上，安全地建立`User`和`Playlist`之间的`@ManyToOne`/`@OneToMany`关联。更新`createPlaylist`逻辑，使其自动关联当前登录的用户。

*   **`12.4-declarative-security.md`: 声明式授权：@PreAuthorize**
    *   **核心思想**: 引入Spring Security最优雅的武器——`@PreAuthorize`。对比在Service中写`if/else`的命令式检查，顿悟“声明式安全”在职责分离和可读性上的巨大优势。
    *   **Vibe Check**:
        1.  **核心练习**: 开启`@EnableMethodSecurity`，创建`isOwner`检查逻辑，并将其应用到Controller的方法上。
        2.  **破坏性实验**: **[终极验证]** 注册用户A和B。用A的JWT创建播放列表。然后用B的JWT去尝试访问A的播放列表，验证是否收到`403 Forbidden`错误。

*   **`12.5-summary-and-blueprint.md`: 总结：你的工程师蓝图**
    *   **核心思想**: 回顾整个“安全三部曲”的旅程。此时再亮出您之前总结的“工程师蓝图”，读者将不再是死记硬背，而是带着亲身经历去印证和内化。展望更高级的安全主题。