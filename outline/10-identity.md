# 第十章：对抗“匿名”：在数字世界中建立身份

> "认识你自己。" - 德尔斐神谕

*   **本章危机**: 我们的系统是完全开放的，任何人都可以访问所有数据。我们无法区分用户，也无法保护用户的私人播放列表。我们的世界，是一个没有“你我”之分的、混乱的“匿名”世界。
*   **本章顿悟**: 我们需要一个数字身份系统，来回答两个根本问题：“你是谁？”（认证）和“你能做什么？”（授权）。

---
## 本章结构

*   **`01-why-security.qmd`: 为何需要认证与授权？**
    *   **内容描述**: 本节将从第一性原理出发，深入探讨为什么在数字世界中，我们需要建立一套身份识别和权限管理系统。我们将清晰地区分**认证（Authentication）**和**授权（Authorization）**这两个核心概念：认证是“验证你是谁”（例如，通过用户名密码登录），而授权是“验证你能做什么”（例如，你是否有权限访问某个资源或执行某个操作）。我们将理解两者缺一不可，是所有安全系统的基石，以及它们如何保护用户数据和系统资源。
    *   **Vibe Check (思考与练习)**:
        1.  **思考**: 想象一个图书馆系统。当你进入图书馆时，你需要出示你的学生证或身份证，这对应的是“认证”还是“授权”？当你借阅一本“仅限教职工”的图书时，图书馆管理员检查你的身份并拒绝你，这对应的是“认证”还是“授权”？
        2.  **AI协同**: 询问你的AI伙伴：“请解释一下常见的认证方式有哪些？例如，密码、指纹、面部识别、短信验证码等，它们各自的优缺点是什么？”
        3.  **设计思考**: 如果你正在设计一个社交媒体应用，哪些功能需要认证？哪些功能需要授权？例如，“查看公开帖子”和“发布私人帖子”分别需要什么？

*   **`02-why-jwt.qmd`: 为何选择JWT？无状态的认证**
    *   **内容描述**: 在HTTP这种无状态协议上，如何让服务器“记住”用户的登录状态，而不需要每次请求都重新登录？本节将对比传统的基于Session的认证方案（在分布式系统中的缺陷）和现代的JWT（JSON Web Token）方案。我们将揭示JWT的本质——它是一个**自包含的、经加密签名的凭证**。我们将理解它如何使得认证逻辑变得**无状态**（服务器不需要存储用户会话信息），从而极易于水平扩展，并适应了微服务架构和移动应用的需求。
    *   **Vibe Check (思考与练习)**:
        1.  **思考**: 如果你的网站部署在多台服务器上，用户第一次登录在服务器A，第二次请求却被路由到服务器B。如果使用传统的Session，服务器B如何知道用户已经登录了？JWT如何解决了这个问题？
        2.  **AI协同**: 询问AI：“请解释JWT的结构（Header, Payload, Signature）以及每个部分的含义。为什么Signature是JWT安全性的关键？”
        3.  **安全思考**: JWT虽然方便，但它也有其安全风险，例如令牌泄露。你认为应该如何存储JWT在客户端（浏览器）？为什么？（提示：LocalStorage vs. HttpOnly Cookie）。

*   **`03-securing-api.qmd`: 保护你的API**
    *   **内容描述**: 在理解了认证、授权和JWT的“为什么”之后，本节将进入“怎么做”。我们将使用Spring Security 6，为我们的API集成基于JWT的认证和授权机制。我们将学习如何配置Spring Security的过滤器链，如何解析和验证JWT，以及如何使用`@PreAuthorize`等注解来保护我们的API端点，确保只有经过认证和授权的用户才能访问特定资源。
    *   **Vibe Check (思考与练习)**:
        1.  **核心练习**: 按照教程步骤，成功配置Spring Security，并实现一个用户注册和登录的API端点，使其能返回JWT。使用Postman或类似工具，测试你是否能成功获取JWT。
        2.  **编码练习**: 为你的`PlaylistController`中的`POST /api/playlists`端点添加安全保护，只允许经过认证的用户创建播放列表。尝试在不携带JWT的情况下访问该端点，观察返回的HTTP状态码（例如401 Unauthorized）。
        3.  **破坏性实验**: 故意篡改一个JWT的Payload部分（例如，修改用户ID），然后尝试用这个篡改过的JWT访问受保护的API。观察Spring Security会如何拒绝这个请求？这如何体现了JWT签名的作用？
        4.  **AI协同与扩展**: 询问AI：“请解释Spring Security中的‘过滤器链’（Filter Chain）是什么？当一个HTTP请求进入Spring Security时，它会经过哪些典型的过滤器？”
