# 11.4 部署到云端

现在，你的应用已经打包好了，并且可以在本地通过 `docker-compose` 完美运行。
是时候让全世界看到它了。我们将把它部署到一台真实的云服务器上。

## 部署流程

### 第一步：拥有一台服务器
你需要一台云服务器（VPS）。阿里云、腾讯云、AWS、DigitalOcean 都可以。

*   **系统**: 推荐 Ubuntu 22.04 LTS 或 Debian 11。
*   **配置**: 2核 4G 内存足矣（Java比较吃内存，1G可能会OOM）。

### 第二步：安装 Docker
SSH 登录到你的服务器，执行以下命令（以Ubuntu为例）：

```bash
# 更新软件源
sudo apt update

# 安装 Docker 和 Docker Compose
sudo apt install -y docker.io docker-compose
```

### 第三步：传输文件
你需要把 `docker-compose.yml` 和 `Dockerfile`（如果选择在服务器构建）传上去。
最简单的方法是使用 `scp` 命令（在你的本地终端执行）：

```bash
# 将当前目录下的文件复制到服务器的 /root/vibevault 目录
scp -r . root@<服务器IP>:/root/vibevault
```

或者，更推荐的方式是使用 **Git**：

1.  把代码推送到 GitHub/Gitee。
2.  在服务器上 `git clone` 下来。

### 第四步：配置管理 (Configuration Management)

**千万不要把密码写死在代码里！**
在生产环境，我们应该使用**环境变量**来传递敏感信息。

修改你的 `docker-compose.yml`，不要直接写 `password`，而是引用环境变量：

```yaml
    environment:
      - SPRING_DATASOURCE_PASSWORD=${DB_PASSWORD}
```

然后在服务器上创建一个 `.env` 文件：

```bash
DB_PASSWORD=MySuperSecretPassword123!
```

Docker Compose 会自动读取同目录下的 `.env` 文件。

### 第五步：启动！

在服务器上：

```bash
cd /root/vibevault
docker-compose up -d --build
```

*   `--build`: 强制重新构建镜像（如果你修改了代码）。

## 验证

打开浏览器，访问 `http://<服务器IP>:8080/api/playlists`。
如果你看到了那个熟悉的JSON数组，恭喜你！你的应用已经上线了！

## Future Vibe: 下一步是什么？

这只是生产环境的起点。在真实的企业级开发中，我们还会引入：

1.  **CI/CD (持续集成/持续部署)**:
    *   你不再手动SSH到服务器去 `git pull`。
    *   你只要 `git push` 到 GitHub，GitHub Actions 就会自动运行测试、构建镜像、推送到镜像仓库，并通知服务器更新。

2.  **反向代理 (Nginx)**:
    *   用户不应该输入 `:8080`。
    *   Nginx 监听 80/443 端口，配置域名（如 `api.vibevault.com`），并转发流量到 8080。
    *   配置 SSL 证书（HTTPS）。

3.  **Kubernetes (K8s)**:
    *   当你的一台服务器撑不住了，需要100台服务器时，Docker Compose就不够用了。
    *   K8s 是容器编排的终极BOSS。

但现在，请为自己鼓掌。你已经走完了从 `Hello World` 到 `Cloud Deployment` 的完整旅程。
