# 10.4 è§„çŸ©ï¼šæˆ‘çš„åœ°ç›˜æˆ‘åšä¸»

æœ‰äº†æŠ¤ç…§ï¼Œä½ å°±èƒ½è¿›é—¨äº†ã€‚ä½†è¿™ä¸ä»£è¡¨ä½ å¯ä»¥ä¸ºæ‰€æ¬²ä¸ºã€‚
æ¯”å¦‚ï¼š**ä½ ä¸èƒ½åˆ åˆ«äººçš„æ­Œå•ã€‚**

è¿™å°±æ˜¯ **æˆæƒ (Authorization)**ã€‚

## ä¸šåŠ¡è¯­ä¹‰ä¼˜å…ˆ

ä¼ ç»Ÿçš„æˆæƒä»£ç å……æ–¥ç€ `if (user.getId() == playlist.getUserId())` è¿™ç§é€»è¾‘ã€‚
Vibe Coding æå€¡ï¼š**ç”¨æ³¨è§£è¡¨è¾¾ä¸šåŠ¡è§„åˆ™**ã€‚

æˆ‘ä»¬å¸Œæœ›å†™å‡ºè¿™æ ·çš„ä»£ç ï¼š

```java
@PreAuthorize("æ˜¯è¿™ä¸ªæ­Œå•çš„ä¸»äºº")
public void deletePlaylist(...)
```

## å®ç° SecurityUtils

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªç¿»è¯‘å®˜ï¼ŒæŠŠâ€œæ˜¯è¿™ä¸ªæ­Œå•çš„ä¸»äººâ€ç¿»è¯‘æˆ Java ä»£ç ã€‚

::: {.callout-tip}
## ğŸ¤– AI Prompt
"è¯·ç”Ÿæˆ `SecurityUtils` ç»„ä»¶ã€‚
åŒ…å«æ–¹æ³• `boolean isOwner(Long id, String username)`ã€‚
é€»è¾‘ï¼šæŸ¥æ•°æ®åº“ï¼Œåˆ¤æ–­æ­Œå•çš„ owner æ˜¯å¦ç­‰äº usernameã€‚"
:::

## å¼€å¯é­”æ³•

1.  åœ¨ `SecurityConfig` ä¸Šæ·»åŠ  `@EnableMethodSecurity`ã€‚
2.  åœ¨ Controller ä¸Šä½¿ç”¨ï¼š

```java
@DeleteMapping("/{id}")
@PreAuthorize("@securityUtils.isOwner(#id, authentication.name)")
public void deletePlaylist(@PathVariable Long id) {
    repository.deleteById(id);
}
```

## Vibe Check

1.  **ç™»å½•ç”¨æˆ· A**ï¼Œè·å– Token Aã€‚
2.  **ç™»å½•ç”¨æˆ· B**ï¼Œåˆ›å»ºæ­Œå• Bã€‚
3.  **å°è¯•ç”¨ Token A åˆ é™¤æ­Œå• B**ã€‚
    *   **é¢„æœŸ**: 403 Forbiddenã€‚

è¿™å°±æ˜¯**è§„çŸ©**ã€‚
