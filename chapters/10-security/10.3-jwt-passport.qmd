# 10.3 æŠ¤ç…§ï¼šJWT é»‘ç›’ç»„ä»¶

"Login Success" è¿™å¥è¯è™½ç„¶å¥½å¬ï¼Œä½†å®ƒä¸èƒ½å½“é¥­åƒã€‚
æˆ‘ä»¬éœ€è¦ç»™ç”¨æˆ·å‘ä¸€å¼ **æ•°å­—æŠ¤ç…§ (JWT)**ï¼Œç”¨æˆ·ä¸‹æ¬¡æ¥çš„æ—¶å€™ï¼Œäº®å‡ºæŠ¤ç…§ï¼Œæˆ‘ä»¬å°±çŸ¥é“ä»–æ˜¯è°äº†ã€‚

## ä»€ä¹ˆæ˜¯ JWTï¼Ÿ

JSON Web Token (JWT) å°±åƒä¸€å¼ **é˜²ä¼ªçš„èº«ä»½è¯**ã€‚
*   **Header**: è¯ä»¶ç±»å‹ã€‚
*   **Payload**: ä¸ªäººä¿¡æ¯ï¼ˆæˆ‘æ˜¯ vibecoderï¼‰ã€‚
*   **Signature**: é˜²ä¼ªå°ç« ï¼ˆåªæœ‰æœåŠ¡å™¨èƒ½ç›–ç« ï¼‰ã€‚

## ç¬¬ä¸€æ­¥ï¼šå¼•å…¥ä¾èµ–

ä¸ºäº†ç”Ÿæˆå’Œè§£æ Tokenï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥ JJWT åº“ã€‚

åœ¨ `gradle/libs.versions.toml` ä¸­æ·»åŠ ï¼š

```toml
[versions]
jjwt = "0.12.6"

[libraries]
jjwt-api = { module = "io.jsonwebtoken:jjwt-api", version.ref = "jjwt" }
jjwt-impl = { module = "io.jsonwebtoken:jjwt-impl", version.ref = "jjwt" }
jjwt-jackson = { module = "io.jsonwebtoken:jjwt-jackson", version.ref = "jjwt" }
```

åœ¨ `build.gradle.kts` ä¸­æ·»åŠ ï¼š

```kotlin
implementation(libs.jjwt.api)
runtimeOnly(libs.jjwt.impl)
runtimeOnly(libs.jjwt.jackson)
```

## é»‘ç›’ç»„ä»¶ (Black Box Components)

å®ç° JWT éœ€è¦å†™å¾ˆå¤šåŠ å¯†ä»£ç ã€‚**ä¸è¦æ‰‹å†™ã€‚** æŠŠå®ƒå½“ä½œç°æˆçš„é›¶ä»¶ã€‚

### é›¶ä»¶ 1ï¼šJwtService (ç­¾å‘å™¨)

::: {.callout-tip}
## ğŸ¤– AI Prompt
"è¯·ç”Ÿæˆ `JwtService` ç±» (ä½¿ç”¨ jjwt åº“)ã€‚
åŒ…å«ï¼š
1. `generateToken(username)`: ç”Ÿæˆ 24å°æ—¶æœ‰æ•ˆçš„ Tokenã€‚
2. `extractUsername(token)`: è§£æç”¨æˆ·åã€‚
3. `isTokenValid(token, userDetails)`: éªŒç­¾ã€‚"
:::

### é›¶ä»¶ 2ï¼šJwtFilter (å®‰æ£€å‘˜)

::: {.callout-tip}
## ğŸ¤– AI Prompt
"è¯·ç”Ÿæˆ `JwtAuthenticationFilter` (ç»§æ‰¿ OncePerRequestFilter)ã€‚
é€»è¾‘ï¼š
1. ä» Header è·å– `Authorization: Bearer xxx`ã€‚
2. éªŒè¯ Tokenã€‚
3. å¦‚æœæœ‰æ•ˆï¼Œå°†ç”¨æˆ·æ”¾å…¥ `SecurityContextHolder` (æ”¾è¡Œ)ã€‚"
:::

### é›¶ä»¶ 3ï¼šç»„è£…

å›åˆ° `SecurityConfig`ï¼Œè®© AI æŠŠ `JwtFilter` æ’åœ¨ `UsernamePasswordAuthenticationFilter` ä¹‹å‰ã€‚

## å‡çº§ç™»å½•æ¥å£

å›åˆ° `AuthController`ï¼Œä¿®æ”¹ `login` æ–¹æ³•ï¼š

```java
// æ—§ä»£ç 
return "Login Success";

// æ–°ä»£ç 
return jwtService.generateToken(user.getUsername());
```

## Vibe Check

å†æ¬¡è°ƒç”¨ `/login` æ¥å£ã€‚
è¿™æ¬¡ä½ åº”è¯¥èƒ½çœ‹åˆ°ä¸€ä¸²é•¿é•¿çš„å­—ç¬¦ï¼š`eyJhbGciOiJIUzI1Ni...`ã€‚
è¿™å°±æ˜¯ä½ çš„**æ•°å­—æŠ¤ç…§**ã€‚ä¿å­˜å¥½å®ƒï¼Œä¸‹ä¸€ç« æˆ‘ä»¬è¦ç”¨å®ƒæ¥è¡Œä½¿æƒåŠ›ã€‚
