# 第十章：构建安全堡垒：全栈安全五部曲

> "你的，才是你的。不是你的，你不能碰。" —— 安全的第一法则

## 本章危机

打开你第八章完成的代码。虽然它功能完善，但它有一个致命的缺陷：**它是完全开放的**。

想象一下，你把家里的钥匙挂在门把手上，然后去上班了。这就是我们现在的系统：

*   **匿名危机**: 谁在敲门？不知道。任何人都可以访问所有API。
*   **越界危机**: 张三可以随意把李四的歌单删得干干净净。
*   **失忆危机**: 即使验证了身份，下一秒就忘了，每次请求都要重新验证。

在Web的世界里，**"默认信任"是致命的**。我们面临的危机是：如何建立一套完整的安全体系，既能识别"谁是谁"（认证），又能控制"谁能做什么"（授权），还要让用户体验足够流畅（无需每次请求都输入密码）？

## 本章顿悟

要保护我们的应用，我们需要构建一个**五层防护体系**，从"锁门"到"发护照"，从"定规矩"到"前后端握手"。

这不是后端的独角戏。真正的安全，是**全栈的安全闭环**。

在本章中，我们将采用**"AI托管配置"**策略。Spring Security的配置复杂且版本迭代快（5.x到6.x有巨大破坏性变更），我们将学会：

*   用业务语言定义安全策略
*   指挥AI生成符合最新标准的配置代码（使用Context7 MCP）
*   专注于理解核心概念，而非记忆API细节

通过本章，你将完成：

1.  **[守门人：Spring Security](./10.1-security-crisis.qmd)**: 配置"默认拒绝"策略，锁住所有未认证请求。理解CSRF和Stateless的本质。
2.  **[身份：用户认证](./10.2-authentication.qmd)**: 创建User实体，使用BCrypt加密密码，实现注册和登录。学习真实世界的密码安全事件。
3.  **[护照：JWT无状态认证](./10.3-jwt-passport.qmd)**: 引入JWT Token，让用户登录一次后24小时内"免检通行"。理解JWT vs Session的权衡。
4.  **[规矩：授权控制](./10.4-authorization.qmd)**: 实现"只有主人能删自己歌单"的业务规则。使用@PreAuthorize注解声明式授权。
5.  **[握手：全栈集成](./10.5-security-testing.qmd)**: **[重磅]** 创建React登录组件，实现Token管理，打通前后端安全闭环。

完成本章后，你的VibeVault将拥有一套生产级的安全体系，从后端的Spring Security到前端的Login界面，从密码加密到Token管理，从认证到授权——这是一个真正可以上线的Web应用的安全基础。
